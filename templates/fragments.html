<!doctype html>
<html>
<head><title>Fragments</title></head>
<body>
<h1>Fragment Browser</h1>

<form method="get">
  <input type="text" name="q" value="{{ query }}" placeholder="Search fragments" size="40" />
  <button type="submit">Search</button>
  {% if query %}<a href="/fragments">Clear</a>{% endif %}
</form>

<form method="post" action="/recombulator">
  <input type="hidden" name="format" value="zip" />

{% if fragments %}
  <ul>
  {% for f in fragments %}
    <li>
      <input type="checkbox" name="fragment_ids" value="{{ f.id }}" />
      <strong>#{{ f.id }}</strong> â€” {{ f.created_at }}<br/>
      <pre>{{ f.content }}</pre>
      {% if f.source %}<em>Source: {{ f.source }}</em>{% endif %}

      {% if similarity.get(f.id) %}
        <details>
          <summary>Related fragments</summary>
          <ul>
            {% for other_id, score in similarity.get(f.id) %}
              <li>#{{ other_id }} (score {{ '%.2f'|format(score) }})</li>
            {% endfor %}
          </ul>
        </details>
      {% endif %}
    </li>
    <hr/>
  {% endfor %}
  </ul>
{% else %}
  <p>No fragments found.</p>
{% endif %}

  <button type="submit">Export selected as ZIP</button>
</form>

<div>
  {% if page > 1 %}
    <a href="/fragments?page={{ page - 1 }}{% if query %}&q={{ query }}{% endif %}">Previous</a>
  {% endif %}
  <span>Page {{ page }}</span>
  {% if fragments|length == 25 %}
    <a href="/fragments?page={{ page + 1 }}{% if query %}&q={{ query }}{% endif %}">Next</a>
  {% endif %}
</div>

<p><a href="/disassembler">Add fragment</a> | <a href="/">Back to home</a></p>
</body>
</html>